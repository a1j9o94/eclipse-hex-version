"use strict";

var Module = require("module");
var path = require("path");
var makeRequireFunction = require("./makeRequireFunction");

module.exports = function makeModuleEnv(filename) {
  if (!path.isAbsolute(filename)) {
    throw new Error("makeModuleEnv requires an absolute path");
  }

  var dirname = path.dirname(filename);

  var mod = new Module(".", null);
  mod.filename = filename;
  mod.paths = Module._nodeModulePaths(filename);

  var req = makeRequireFunction(mod);
  req.main = mod;

  var exps = {};
  mod.exports = exps;

  return {
    exports: exps,
    require: req,
    module: mod,
    __filename: filename,
    __dirname: dirname
  };
};